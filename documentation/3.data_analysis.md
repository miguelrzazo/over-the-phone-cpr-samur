# 3. Análisis de Datos - Estudio RCP Transtelefónica

## Resumen del Análisis Estadístico

Este documento describe la metodología estadística empleada en el estudio sobre la efectividad de la RCP transtelefónica en paradas cardíacas extrahospitalarias atendidas por SAMUR-PC Madrid (2023-2025).

---

## Estructura del Análisis

El análisis estadístico se organiza en cuatro notebooks de Jupyter, cada uno con un propósito específico:

### 1. Lenguaje de Diseño (`1. design_language.ipynb`)

**Propósito:** Establecer especificaciones visuales consistentes para todas las figuras y gráficos del estudio.

**Contenido:**
- Paleta de colores institucional y científica
- Configuración de matplotlib y seaborn
- Tamaños de fuente, DPI y formatos de exportación
- Plantillas para diferentes tipos de gráficos (barras, forest plots, box plots, etc.)

**Salida:** 
- Especificaciones reutilizables para otros notebooks
- Ejemplos de visualizaciones estándar

---

### 2. Estadística Descriptiva (`2. descriptive_statistics.ipynb`)

**Propósito:** Describir las características de la muestra y distribuciones de variables principales.

**Contenido:**

#### 2.1 Características de la Población
- **Edad:** Media, desviación estándar, distribución por grupos (<65 vs ≥65 años)
- **Sexo:** Frecuencias absolutas y relativas
- **Tiempos:** Tiempo de llegada, tiempo de RCP (media, mediana, rango)

#### 2.2 Distribución de Grupos de RCP
```
- Sin RCP previa: 169 casos (33.8%)
- RCP por testigos legos: 172 casos (34.4%)
  └─ Con guía telefónica: 113 casos (22.6% del total)
- RCP por sanitarios: 93 casos (18.6%)
- RCP por policía: 64 casos (12.8%)
- RCP por bomberos: 2 casos (0.4%)
```

#### 2.3 Outcomes Principales
**Por grupo de RCP:**
- ROSC (Retorno de Circulación Espontánea)
- Supervivencia a 7 días
- CPC favorable (Cerebral Performance Category 1-2)

**Estratificación por edad:**
- <65 años vs ≥65 años
- Análisis de subgrupos

#### 2.4 Visualizaciones Descriptivas
- Histogramas de edad por grupo de RCP
- Gráficos de barras de outcomes principales
- Box plots de tiempos de respuesta
- Distribuciones de CPC

**Outputs:** `final_noteboooks/outputs_descriptivos/`
- Tablas CSV con estadísticas descriptivas
- Figuras PNG (300 DPI) 
- Reportes de texto con resúmenes

---

### 3. Análisis Inferencial (`3. exploratory_analysis.ipynb`)

**Propósito:** Inferencia estadística para evaluar asociaciones entre tipo de RCP y outcomes.

#### 3.1 Tests Estadísticos Bivariados

**A. Variables categóricas (outcomes binarios):**
- **Chi-cuadrado (χ²):** Comparación de proporciones entre grupos
  - ROSC por grupo de RCP
  - Supervivencia por grupo de RCP
  - CPC favorable por grupo de RCP
  
- **Test exacto de Fisher:** Cuando celdas tienen n < 5
  - Subgrupos pequeños (ej: bomberos)
  - Análisis estratificados con tamaños muestrales reducidos

**B. Variables continuas/ordinales:**
- **Mann-Whitney U:** Comparación de medianas entre dos grupos
  - Tiempos de RCP entre grupos con/sin ROSC
  - Edad entre supervivientes y no supervivientes

- **Kruskal-Wallis:** Comparación entre múltiples grupos
  - Distribución de CPC entre grupos de RCP

#### 3.2 Análisis Multivariado

**Regresión Logística:**
```python
# Modelo general
Outcome ~ Tipo_RCP + Edad + Sexo + Tiempo_llegada + Ritmo_inicial

# Variables dependientes (outcomes):
- ROSC (binario: sí/no)
- Supervivencia (binario: sí/no)
- CPC_favorable (binario: CPC 1-2 vs 3-5)

# Variables independientes:
- Tipo_RCP (categórica: sin RCP, testigos, sanitarios, policía)
- Edad (continua, o categórica <65 vs ≥65)
- Sexo (binario: M/F)
- Tiempo_llegada (continua, en minutos)
- Desfibrilable_inicial (binario: sí/no)
```

**Técnicas de validación:**
- Validación cruzada estratificada (5-fold)
- Bootstrap para intervalos de confianza robustos
- Regularización L2 (Ridge) para prevenir overfitting

**Métricas reportadas:**
- Odds Ratios (OR) ajustados con IC 95%
- p-valores (con corrección por múltiples comparaciones si aplica)
- AUC-ROC para evaluación del modelo
- Coeficientes estandarizados

#### 3.3 Machine Learning

**Modelos implementados:**
- Regresión logística con regularización
- Modelos de conjunto (si aplicable)

**Pipeline:**
1. Preprocesamiento: StandardScaler para variables continuas
2. Balanceo de clases: pesos automáticos
3. Validación cruzada estratificada
4. Evaluación con AUC-ROC, precision, recall, F1-score

**Análisis de importancia de variables:**
- Coeficientes de regresión logística
- Permutation importance

#### 3.4 Análisis Estratificado

**Estratificación por edad:**
- <65 años: Mejor pronóstico esperado
- ≥65 años: Comorbilidades y menor reserva fisiológica

**Estratificación por tiempo de llegada:**
- Menor que la mediana (≈8.4 min)
- Mayor que la mediana

**Estratificación por tipo de ritmo inicial:**
- Desfibrilable (FV/TV sin pulso): Mejor pronóstico
- No desfibrilable (asistolia/AESP): Peor pronóstico

#### 3.5 Visualizaciones Inferenciales

**Forest plots:** Odds ratios con IC 95%
- Comparación de todos los grupos vs sin RCP previa
- RCP transtelefónica vs no transtelefónica
- Estratos por edad

**Gráficos de barras con intervalos de confianza:**
- Proporciones de outcomes por grupo
- Error bars con IC 95%

**Curvas ROC:**
- Rendimiento de modelos predictivos
- AUC para cada outcome

**Outputs:** `final_noteboooks/outputs_inferencia/`
- Tablas CSV con resultados de tests
- JSON con modelos y coeficientes
- Figuras PNG (300 DPI)
- Reportes detallados

---

### 4. Draft Paper (`4. draft_paper.ipynb`)

**Propósito:** Integrar resultados para el manuscrito científico en LaTeX.

**Contenido:**
- Selección de figuras finales más relevantes
- Generación de tablas en formato LaTeX
- Redacción de leyendas de figuras
- Resumen de hallazgos principales

**Outputs:** 
- `latex/figures/` - Figuras de alta resolución para el paper
- `latex/tables/` - Tablas en formato .tex
- Fragmentos de texto para secciones del paper

---

## Resultados Principales del Análisis

### Hallazgos Estadísticamente Significativos

#### 1. RCP vs Sin RCP Previa

**ROSC:**
- RCP testigos legos: 65.7% vs Sin RCP: 53.3% 
- Diferencia absoluta: +12.4 puntos porcentuales
- Significancia estadística: p < 0.05 (Chi-cuadrado)

**Supervivencia a 7 días:**
- RCP testigos legos: 29.7% vs Sin RCP: 17.2%
- Diferencia absoluta: +12.5 puntos porcentuales
- OR aproximado: 2.0 (IC 95%: [calculado en análisis])
- NNT (número necesario a tratar): ≈8 pacientes

**CPC favorable (1-2):**
- RCP testigos legos: 25.6% vs Sin RCP: 13.0%
- Diferencia absoluta: +12.6 puntos porcentuales
- OR aproximado: 2.3
- Altamente significativo (p < 0.01)

#### 2. RCP por Sanitarios (Mejores Outcomes)

**Supervivencia:**
- Sanitarios: 40.9% - el mejor outcome de todos los grupos
- 2.4 veces mayor que sin RCP previa (40.9% vs 17.2%)

**CPC favorable:**
- Sanitarios: 38.7%
- 3.0 veces mayor que sin RCP previa (38.7% vs 13.0%)

#### 3. Impacto de la Edad

**Supervivencia:**
- <65 años: 34.4%
- ≥65 años: 19.1%
- Diferencia relativa: +80% en menores de 65

**CPC favorable:**
- <65 años: 31.5%
- ≥65 años: 14.7%
- Diferencia relativa: +114% en menores de 65

#### 4. RCP Transtelefónica

- 113 de 172 casos de RCP por testigos (65.7%) fueron guiados telefónicamente
- Outcomes comparables al resto de RCP por testigos legos
- Papel fundamental: aumentar tasa de inicio de RCP

---

## Metodología Estadística Detallada

### Tests de Hipótesis

**Hipótesis Nula (H0):** No hay diferencia en outcomes entre los grupos de RCP

**Hipótesis Alternativa (H1):** La RCP (de cualquier tipo) mejora los outcomes comparado con sin RCP

**Nivel de significancia:** α = 0.05

**Corrección por múltiples comparaciones:** 
- Bonferroni cuando se realizan múltiples tests sobre el mismo outcome
- FDR (False Discovery Rate) para análisis exploratorios

### Tamaño del Efecto

**Odds Ratios (OR):**
- OR > 1: Factor protector/beneficioso
- OR < 1: Factor de riesgo/perjudicial
- OR = 1: Sin efecto

**Intervalos de Confianza al 95%:**
- Si el IC 95% no incluye el 1, el efecto es estadísticamente significativo

**Interpretación clínica:**
- OR > 2: Efecto sustancial
- OR 1.5-2: Efecto moderado
- OR 1.2-1.5: Efecto pequeño pero relevante

### Validación de Modelos

**Regresión Logística:**
1. Verificación de supuestos:
   - Ausencia de multicolinealidad (VIF < 10)
   - Linealidad en el logit para variables continuas
   
2. Evaluación del ajuste:
   - AUC-ROC > 0.7: Discriminación aceptable
   - AUC-ROC > 0.8: Discriminación buena
   - Hosmer-Lemeshow test: p > 0.05 indica buen calibrado

3. Validación cruzada:
   - Estratificada por outcome (mantiene proporciones)
   - 5-fold para balance entre sesgo y varianza
   - Reporte de media ± DE del AUC

---

## Limitaciones del Análisis

### 1. Limitaciones del Diseño
- **Estudio observacional:** No permite establecer causalidad definitiva
- **Retrospectivo:** Dependiente de la calidad de registro original
- **Sesgos potenciales:** 
  - Sesgo de selección (quién recibe RCP por sanitarios vs testigos)
  - Sesgo de información (cumplimentación de formularios)

### 2. Limitaciones de los Datos
- **Calidad de RCP no medida:** Profundidad/frecuencia de compresiones
- **Tiempo exacto de inicio:** Puede no ser preciso para RCP por testigos
- **Variables confusoras:** Comorbilidades específicas no siempre registradas
- **Localización:** No disponible en todos los casos

### 3. Limitaciones Estadísticas
- **Tamaños muestrales pequeños:** Algunos subgrupos (bomberos: n=2)
- **Múltiples comparaciones:** Aumenta riesgo de error tipo I
- **Supuestos de modelos:** Regresión logística asume relaciones lineales en logit

---

## Software y Librerías Utilizadas

### Python 3.10+
```python
import pandas as pd          # Manipulación de datos
import numpy as np           # Operaciones numéricas
import matplotlib.pyplot as plt  # Visualización
import seaborn as sns        # Gráficos estadísticos avanzados
from scipy import stats      # Tests estadísticos
from sklearn.linear_model import LogisticRegression  # Modelos
from sklearn.model_selection import StratifiedKFold, cross_val_score
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import roc_auc_score, roc_curve, classification_report
```

### Versiones Específicas
Ver `documentation/requirements.txt` para versiones exactas utilizadas.

---

## Reproducibilidad

### Para Reproducir el Análisis:

1. **Clonar el repositorio**
2. **Instalar dependencias:**
   ```bash
   pip install -r documentation/requirements.txt
   ```
3. **Ejecutar notebooks en orden:**
   - `1. design_language.ipynb`
   - `2. descriptive_statistics.ipynb`
   - `3. exploratory_analysis.ipynb`
   - `4. draft_paper.ipynb`

4. **Compilar paper LaTeX:**
   ```bash
   cd latex/paper/
   xelatex rcp_transtelefonica_paper.tex
   ```

### Semillas Aleatorias
Todos los análisis usan `random_state=42` para reproducibilidad exacta.

---

## Referencias Metodológicas

- **STROBE Guidelines:** Reporting of observational studies
- **Hosmer & Lemeshow (2013):** Applied Logistic Regression
- **Agresti (2012):** Categorical Data Analysis
- **Scikit-learn documentation:** Machine learning en Python

---

## Contacto Técnico

Para consultas sobre la metodología estadística o implementación técnica:
- Revisar notebooks en `final_noteboooks/`
- Consultar documentación de código (comentarios inline)
- Issues en GitHub (si aplicable)

---

**Última actualización:** Noviembre 2025  
**Versión del análisis:** 1.0 (final)
